services:
  overseerr:
    image: lscr.io/linuxserver/overseerr:latest
    container_name: overseerr-test
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
    volumes:
      - ./overseerr-config:/config
    ports:
      - "0.0.0.0:5055:5055"
    restart: unless-stopped
    networks:
      - overseerr-network
    depends_on:
      - radarr-mock
      - sonarr-mock
      - plex-mock
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5055/api/v1/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Mock Plex server for authentication testing
  plex-mock:
    image: nginx:alpine
    container_name: plex-mock
    volumes:
      - ./plex-mock/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./plex-mock/html:/usr/share/nginx/html:ro
    ports:
      - "32400:32400"
    networks:
      - overseerr-network
    healthcheck:
      test: ["CMD-SHELL", "pidof nginx || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 3
      start_period: 5s

  # Mock Radarr for movie management
  radarr-mock:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr-mock
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
    volumes:
      - ./radarr-config:/config
    ports:
      - "7878:7878"
    networks:
      - overseerr-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7878/ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

  # Mock Sonarr for TV show management
  sonarr-mock:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr-mock
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
    volumes:
      - ./sonarr-config:/config
    ports:
      - "8989:8989"
    networks:
      - overseerr-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8989/ping"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

networks:
  overseerr-network:
    driver: bridge
